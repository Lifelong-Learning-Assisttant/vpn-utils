# VPN Utilities

ะะฐะฑะพั ััะธะปะธั ะธ ะดะพะบัะผะตะฝัะฐัะธะธ ะดะปั ะฝะฐัััะพะนะบะธ VPN ะฒ ะฟัะพะตะบัะต.

## ๐ฏ ะะพะฒะฐั ัััะฐัะตะณะธั (2025-12-29)

**Split routing: OpenAI/OpenRouter ัะตัะตะท VPN, ะฒัั ะพััะฐะปัะฝะพะต ะฝะฐะฟััะผัั**

### ะัะพะฑะปะตะผะฐ
- **OpenRouter ะธ OpenAI** ะฑะปะพะบะธัััั ะดะพัััะฟ ะธะท ะะค (403 ะพัะธะฑะบะฐ)
- **GitHub, Docker, PyPI** ะธัะฟะพะปัะทััั CDN (Cloudflare, Fastly) ั ัะฐััะพ ะผะตะฝัััะธะผะธัั IP
- **VPN ััะฐัะธะบ ะพะณัะฐะฝะธัะตะฝ** (4 ะะ/ะผะตััั) โ ะบะพะฝัะตะนะฝะตัั ะฑััััะพ ะตะณะพ ัะฐััะพะดััั
- **ะัะต ัะตัะฒะธัั CDN** โ IP-ะฐะดัะตัะฐ ะฟะพััะพัะฝะฝะพ ะผะตะฝััััั

### ะะพะฟััะบะธ ัะตัะธัั:
1. โ **ะกะฟะธัะพะบ IP ะดะปั OpenRouter/OpenAI** โ ะฝะต ัะฐะฑะพัะฐะตั, IP ะผะตะฝััััั
2. โ **ะะตัั ััะฐัะธะบ ัะตัะตะท VPN** โ ัะฐััะพะดัะตั 4 ะะ ะฑััััะพ, Docker/PyPI ัะพัะผะพะทัั
3. โ **Split routing ะฟะพ ะดะธะฐะฟะฐะทะพะฝะฐะผ** โ ัะพะปัะบะพ ะฝะตะนัะพัะตัะธ ัะตัะตะท VPN, ะพััะฐะปัะฝะพะต ะฝะฐะฟััะผัั

### ะะตัะตะฝะธะต
**Policy-based routing** โ ััะฐัะธะบ ะดะตะปะธััั ะฟะพ **IP-ะดะธะฐะฟะฐะทะพะฝะฐะผ**:
- โ **OpenAI + OpenRouter** โ ัะตัะตะท VPN (Frankfurt) โ ัะพะปัะบะพ ััะฐัะธะบ LLM
- โ **GitHub, Docker, PyPI** โ ะฝะฐะฟััะผัั (ะฑััััะพ, ะฑะตะท ะพะณัะฐะฝะธัะตะฝะธะน)
- โ **SSH** โ ะฝะฐะฟััะผัั (ััะฐะฑะธะปัะฝะพ)

**ะัะพะณ:** 4 ะะ VPN ัะฒะฐัะธั ัะพะปัะบะพ ะดะปั ะพะฑัะตะฝะธั ั LLM, ะฒัั ะพััะฐะปัะฝะพะต ัะฐะฑะพัะฐะตั ะฝะฐ ะฟะพะปะฝะพะน ัะบะพัะพััะธ!

---

## ๐ ะกัััะบัััะฐ ะดะพะบัะผะตะฝัะฐัะธะธ

### ๐ ะัััััะน ััะฐัั
1. **[docs/dns_vpn_setup.md](docs/dns_vpn_setup.md)** โ ะะพะดะบะปััะตะฝะธะต VPN
2. **[docs/network_architecture.md](docs/network_architecture.md)** โ ะะฐะบ ัะฐะฑะพัะฐะตั split routing

### ๐๏ธ ะกะบัะธะฟัั
- **`setup_split_routing.sh`** โ ะะฐัััะพะนะบะฐ split routing
- **`test_split_routing.sh`** โ ะขะตััะธัะพะฒะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ

### ๐ ะกะฟัะฐะฒะพัะฝะธะบะธ
- **[docs/adguard_vpn_setup.md](docs/adguard_vpn_setup.md)** โ ะะพะผะฐะฝะดั AdGuard VPN
- **[docs/dns_base.md](docs/dns_base.md)** โ ะะพัััะฐะฝะพะฒะปะตะฝะธะต DNS

---

## ๐ ะัััััะน ััะฐัั

### 1. ะะพะดะบะปััะตะฝะธะต VPN
```bash
# ะะพะดะบะปััะธัั VPN
adguardvpn-cli connect -l FRANKFURT

# ะัะบะปััะธัั ะฐะฒัะพะผะฐัะธัะตัะบัั ัะผะตะฝั DNS (ะฒะฐะถะฝะพ!)
adguardvpn-cli config set-change-system-dns off
```

### 2. ะะฐัััะพะนะบะฐ split routing
```bash
# ะะฐะฟัััะธัั ัะบัะธะฟั (ััะตะฑัะตั sudo)
sudo ./setup_split_routing.sh
```

### 3. ะัะพะฒะตัะบะฐ
```bash
# ะะฐะฟัััะธัั ัะตััั
./test_split_routing.sh
```

---

## ๐ฏ ะงัะพ ะดะตะปะฐะตั split routing

### ะะฐัััััะธะทะฐัะธั:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะฐั ัะตัะฒะตั (176.123.161.187)            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                         โ
โ  SSH โ table 100 โ ะัะพะฒะฐะนะดะตั (ะฝะฐะฟััะผัั) โ
โ                                         โ
โ  OpenAI โ table 880 โ VPN (Frankfurt)   โ
โ  OpenRouter โ table 880 โ VPN           โ
โ                                         โ
โ  GitHub โ ะัะพะฒะฐะนะดะตั (ะฝะฐะฟััะผัั)          โ
โ  Docker โ ะัะพะฒะฐะนะดะตั (ะฝะฐะฟััะผัั)          โ
โ  PyPI โ ะัะพะฒะฐะนะดะตั (ะฝะฐะฟััะผัั)            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะตะทัะปััะฐั:
- โ **OpenAI API** ัะฐะฑะพัะฐะตั (ัะตัะตะท VPN)
- โ **OpenRouter API** ัะฐะฑะพัะฐะตั (ัะตัะตะท VPN)
- โ **GitHub** โ ะผะฐะบัะธะผะฐะปัะฝะฐั ัะบะพัะพััั (ะฝะฐะฟััะผัั)
- โ **Docker/PyPI** โ ะผะฐะบัะธะผะฐะปัะฝะฐั ัะบะพัะพััั (ะฝะฐะฟััะผัั)
- โ **SSH** โ ะฒัะตะณะดะฐ ะดะพัััะฟะตะฝ (ะฝะฐะฟััะผัั)

---

## ๐ ะะธะฐะณะฝะพััะธะบะฐ

```bash
# ะะพะปะฝะฐั ะดะธะฐะณะฝะพััะธะบะฐ ัะตัะธ
./test_split_routing.sh

# ะะปะธ ะฒัััะฝัั:
# 1. VPN ััะฐััั
adguardvpn-cli status

# 2. ะะฐัััััั
ip route get 162.159.140.245  # OpenAI โ ะดะพะปะถะตะฝ ะฑััั tun0
ip route get 140.82.121.3     # GitHub โ ะดะพะปะถะตะฝ ะฑััั enp3s0

# 3. ะัะฐะฒะธะปะฐ
ip rule show | grep "176.123.161.187"
```

---

## ๐๏ธ Troubleshooting

### ะัะพะฑะปะตะผะฐ: OpenAI ะฝะต ัะฐะฑะพัะฐะตั
```bash
# 1. ะัะพะฒะตัะธัั VPN
adguardvpn-cli status

# 2. ะะตัะตะทะฐะฟัััะธัั split routing
sudo ./setup_split_routing.sh
```

### ะัะพะฑะปะตะผะฐ: GitHub ะผะตะดะปะตะฝะฝัะน
```bash
# ะัะพะฒะตัะธัั ะผะฐัััััั
ip route get 140.82.121.3
# ะะพะปะถะฝะพ ะฑััั: via 176.123.160.1 dev enp3s0
```

### ะัะพะฑะปะตะผะฐ: SSH ะพัะบะปััะฐะตััั
```bash
# ะัะพะฒะตัะธัั ะฟัะฐะฒะธะปะพ
ip rule show | grep "176.123.161.187"
# ะะพะปะถะฝะพ ะฑััั: lookup 100
```

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะพ

### ะกะบัะธะฟั setup_split_routing.sh
ะกะพะทะดะฐะตั:
- โ ะัะฐะฒะธะปะฐ ะดะปั Cloudflare ะดะธะฐะฟะฐะทะพะฝะพะฒ (OpenAI)
- โ ะัะฐะฒะธะปะฐ ะดะปั OpenRouter IP (8.6.112.0/24, 8.47.69.0/24)
- โ ะกะพััะฐะฝัะตั SSH ะฟัะฐะฒะธะปะพ (table 100)

### ะกะบัะธะฟั test_split_routing.sh
ะัะพะฒะตััะตั:
- โ ะะฐัััััะธะทะฐัะธั ะดะปั ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ
- โ ะะพัััะฟะฝะพััั API
- โ ะกัะฐััั VPN
- โ Policy routing

---

## ๐ ะะตััะธะธ

- **ะะตััะธั ะดะพะบัะผะตะฝัะฐัะธะธ:** 2025-12-29
- **ะกัะฐััั:** โ Split routing ัะฐะฑะพัะฐะตั
- **ะขะธะฟ ััะฐัะธะบะฐ:** Selective (OpenAI/OpenRouter โ VPN, ะพััะฐะปัะฝะพะต โ ะฟัะพะฒะฐะนะดะตั)

---

## โก ะะพะผะฐะฝะดั ะฒ ะพะดะฝั ัััะพะบั

```bash
# ะะพะดะบะปััะธัั VPN + ะฝะฐัััะพะธัั split routing
adguardvpn-cli connect -l FRANKFURT && \
adguardvpn-cli config set-change-system-dns off && \
sudo ./setup_split_routing.sh && \
./test_split_routing.sh
```