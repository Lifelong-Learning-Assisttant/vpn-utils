# –°–µ—Ç–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –î–æ—Å—Ç—É–ø –∫ OpenRouter –∏–∑ –†–æ—Å—Å–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞

### –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
OpenRouter –∏ OpenAI –±–ª–æ–∫–∏—Ä—É—é—Ç –¥–æ—Å—Ç—É–ø –∏–∑ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö IP-–∞–¥—Ä–µ—Å–æ–≤:
```
OpenRouter: Error code: 403 - {'error': {'message': 'Access denied: This service is not available in your region.'}}
OpenAI: Error code: 403 - {'error': {'code': 'unsupported_country_region_territory', 'message': 'Country, region, or territory not supported'}}
```

### –î–∏–ª–µ–º–º–∞
- **VPN –¥–ª—è –≤—Å–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞**: ‚ùå –õ–æ–º–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º –≤ –†–§
- **–ë–µ–∑ VPN**: ‚ùå OpenRouter –∏ OpenAI –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- **–†–µ—à–µ–Ω–∏–µ**: ‚úÖ –°–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π VPN (—Ç–æ–ª—å–∫–æ openrouter.ai –∏ api.openai.com)

## –°—Ö–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ç–∏

```mermaid
graph TB
    subgraph "–í–∞—à —Å–µ—Ä–≤–µ—Ä –≤ –ú–æ—Å–∫–≤–µ"
        LS[("–õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
        ‚Ä¢ API —Å–µ—Ä–≤–µ—Ä–∞
        ‚Ä¢ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
        ‚Ä¢ –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
        ‚Ä¢ –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤—ã–∑–æ–≤—ã
        ‚Ä¢ –í—Å–µ, –∫—Ä–æ–º–µ openrouter.ai")]
        
        MR[("–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
        ‚Ä¢ –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ ‚Üí eth0 (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø)
        ‚Ä¢ openrouter.ai ‚Üí tun0 (—á–µ—Ä–µ–∑ VPN)")]
        
        subgraph "–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø (eth0)"
            PD[("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
            ‚Ä¢ 127.0.0.0/8
            ‚Ä¢ 10.0.0.0/8
            ‚Ä¢ 192.168.0.0/16
            ‚Ä¢ –†—É–Ω–µ—Ç")]
        end
        
        subgraph "VPN —Ç—É–Ω–Ω–µ–ª—å (tun0)"
            VPN[("VPN —Ç—É–Ω–Ω–µ–ª—å
            ‚Ä¢ openrouter.ai
            ‚Ä¢ 104.18.x.x")]
        end
        
        LS --> MR
        MR --> PD
        MR --> VPN
    end
    
    style LS fill:#e1f5ff
    style MR fill:#fff4e1
    style PD fill:#e8f5e9
    style VPN fill:#fce4ec
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. AdGuard VPN CLI (Selective Mode)
**–†–µ–∂–∏–º**: `selective`
**–ò—Å–∫–ª—é—á–µ–Ω–∏—è**: `openrouter.ai`, `api.openrouter.ai`, `api.openai.com`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: VPN –∞–∫—Ç–∏–≤–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤.

### 2. –°–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
**–§–∞–π–ª**: `agent_service/fix-vpn-routes.sh`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VPN —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É 880
2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç IP-–∞–¥—Ä–µ—Å–∞ OpenRouter —á–µ—Ä–µ–∑ DNS
3. –£–¥–∞–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–æ `lookup 880` (–∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –í–ï–°–¨ —Ç—Ä–∞—Ñ–∏–∫)
4. –£–¥–∞–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∞–≤–∏–ª
5. –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ—á–µ—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è IP-–∞–¥—Ä–µ—Å–æ–≤ OpenRouter
6. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `vpn`
7. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### 3. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

#### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø—Ä–æ–±–ª–µ–º–∞):
```bash
# –ü—Ä–∞–≤–∏–ª–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –≤—Å–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
30801: from all lookup 880

# –†–µ–∑—É–ª—å—Ç–∞—Ç: –í–ï–°–¨ —Ç—Ä–∞—Ñ–∏–∫ ‚Üí VPN ‚Üí ‚ùå –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
```

#### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ä–∞–±–æ—Ç–∞–µ—Ç):
```bash
# –¢–æ—á–µ—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è OpenRouter
104.18.2.115 dev tun0 table vpn
104.18.3.115 dev tun0 table vpn

# –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ ‚Üí –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
127.0.0.0/8 dev eth0
10.0.0.0/8 dev eth0
192.168.0.0/16 dev eth0

# –†–µ–∑—É–ª—å—Ç–∞—Ç: 
# - openrouter.ai ‚Üí VPN ‚úÖ
# - –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã ‚Üí –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø ‚úÖ
```

## –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ü–æ—á–µ–º—É selective mode?
- ‚úÖ VPN —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω—É–∂–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ –û—Å—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –±–µ–∑ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è

### –ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è?
- ‚ùå AdGuard VPN –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å `lookup 880`
- ‚úÖ –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª—è–µ—Ç —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–æ—á–µ—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç IP-–∞–¥—Ä–µ—Å–∞ OpenRouter

### –ü–æ—á–µ–º—É systemd/cron?
- ‚è∞ VPN –º–æ–∂–µ—Ç –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- üõ°Ô∏è –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

## –†–µ–∑—é–º–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: OpenRouter –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –†–§, –Ω–æ –ø–æ–ª–Ω—ã–π VPN –ª–æ–º–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã.

**–†–µ—à–µ–Ω–∏–µ**: –°–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π VPN + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤.

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: OpenRouter —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ VPN, –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã ‚Äî –Ω–∞–ø—Ä—è–º—É—é.

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: Systemd timer –∏–ª–∏ cron job –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

## –°–º. —Ç–∞–∫–∂–µ

- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ AdGuard VPN CLI](./adguard_vpn_setup.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VPN
- [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤](./open_router_vpn.md) - –°–∫—Ä–∏–ø—Ç –∏ systemd
- [–°–µ—Ç–µ–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ](./network_interaction.md) - –û–±—â–∞—è —Å–µ—Ç–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞