# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ç–∏: VPN + Dev Container + LLM proxy

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–¶–µ–ª—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã ‚Äî –æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã –≤—Å–µ –≤—ã–∑–æ–≤—ã LLM (OpenAI, Gemini, OpenRouter –∏ —Ç.–¥.) –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —á–µ—Ä–µ–∑ VPN, –ø—Ä–∏ —ç—Ç–æ–º:

* –Ω–µ –º–µ–Ω—è—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Ö–æ—Å—Ç–∞;
* –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ipset/fwmark/–º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤;
* –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –º–µ–Ω—è—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: —Ç–æ–ª—å–∫–æ —Ç–µ –º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç LLM-–≤—ã–∑–æ–≤—ã, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π proxy;
* developer credentials —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ dev-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –∏—Å—á–µ–∑–∞—é—Ç –ø—Ä–∏ –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏–∏;
* dev-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (VS Code Server, Kilo CLI) –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç VPN-—Å–µ—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é;
* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ docker-compose —Ñ–∞–π–ª—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥–∏–±–∫–æ—Å—Ç–∏.

---

## –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞

```mermaid
graph TB
  subgraph Host["Host"]
    docker["Docker Engine / bridge"]
  end

  subgraph VPN_NS["VPN Container (vpn) ‚Äî network namespace"]
    tun0["tun0 (adguardvpn-cli)"]
    dns["AdGuard DNS Resolver"]
    dante["Dante (SOCKS5) :1080"]
    tiny["Tinyproxy (HTTP) :1090"]
  end

  subgraph Dev["Dev Container (dev)"]
    vscode["VS Code Server"]
    kilo["Kilo CLI"]
  end

  subgraph Apps["App Containers"]
    app1["App1 (LLM calls -> socks5h://vpn:1080)"]
    app2["App2 (LLM calls -> socks5h://vpn:1080)"]
  end

  docker --> Apps
  docker --> Dev

  Dev -- network_mode: container:vpn --> VPN_NS
  Apps -- docker network vpn-net --> VPN_NS

  app1 --> dante
  app2 --> dante
  vscode --> tiny
  kilo --> dante

  dante --> tun0
  tiny --> tun0
  tun0 --> Internet["Internet / LLM Providers"]
```

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Ä–æ–ª–∏

### 1) VPN –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (container_name: `vpn`)

**–†–æ–ª—å:** –ø–æ–¥–Ω–∏–º–∞–µ—Ç VPN (adguardvpn-cli), —Å–æ–∑–¥–∞—ë—Ç `tun0`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç DNS resolver –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–∫—Å–∏:

* **tun0** ‚Äî VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (tcp-only –¥–ª—è adguardvpn-cli);
* **AdGuard DNS resolver** ‚Äî —Ä–µ–∑–æ–ª–≤ –≤–Ω—É—Ç—Ä–∏ vpn-namespace;
* **Dante** ‚Äî SOCKS5 proxy (–ø–æ—Ä—Ç 1080), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `socks5h` (—Ä–µ–∑–æ–ª–≤ —É –ø—Ä–æ–∫—Å–∏);
* **Tinyproxy** ‚Äî HTTP proxy (–ø–æ—Ä—Ç 1090), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç CONNECT –¥–ª—è HTTPS.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

* `cap_add: NET_ADMIN` –∏ `devices: /dev/net/tun` —á—Ç–æ–±—ã –ø–æ–¥–Ω—è—Ç—å tun-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å;
* —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ `cap_drop: ALL` + –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ NET_ADMIN;
* –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `--privileged` –∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç—å `network_mode: host`.

---

### 2) Dev –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (container_name: `dev`)

**–†–æ–ª—å:** Dev-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (VS Code Server, Kilo CLI).
**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:** `network_mode: "container:vpn"` ‚Äî dev-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ç–µ–≤–æ–π namespace VPN-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —Ç–µ–º —Å–∞–º—ã–º –≤–µ—Å—å –µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫ –∏ DNS –∏–¥—É—Ç —á–µ—Ä–µ–∑ VPN.

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ Kilo CLI –∏ VS Code extension (Kilo Code)**

* **Kilo CLI** –∑–∞–ø—É—â–µ–Ω –≤–Ω—É—Ç—Ä–∏ `dev` (–∞ dev –¥–µ–ª–∏—Ç netns —Å `vpn`) ‚Äî –≤—Å–µ –µ–≥–æ outbound-–∑–∞–ø—Ä–æ—Å—ã –∫ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –∏–¥—É—Ç —á–µ—Ä–µ–∑ `tun0` –∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ VPN (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ).
* **VS Code Server** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTP proxy –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π; –æ–¥–Ω–∞–∫–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –±—ã–ª–æ –∑–∞–º–µ—á–µ–Ω–æ, —á—Ç–æ LLM-–≤—ã–∑–æ–≤—ã (–æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è Kilo Code) —à–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –≤ —Å—Ç–∞—Ä–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –º–∏–Ω–æ–≤–∞–ª–∏ proxy/`tun0`.

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏ –∫–∞–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã:**

1. **Extension –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ—à–Ω–∏–π –±–µ–∫–µ–Ω–¥:** –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑—É—é—Ç LLM-–≤—ã–∑–æ–≤—ã —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ HTTP-–∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –º–æ–≥—É—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å VS Code http.proxy, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –ø—Ä—è–º—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –¢–æ–≥–¥–∞ —Ç—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç –Ω–∞–ø—Ä—è–º—É—é, –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–æ –∏–Ω–∞—á–µ.
2. **Extension –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã Kilo CLI:** –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π Kilo backend/CLI –¥–ª—è LLM-–∑–∞–ø—Ä–æ—Å–æ–≤ (—Ç–æ –µ—Å—Ç—å extension –≤—ã–∑—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π CLI, –∞ CLI –¥–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã), —Ç–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–π–¥—É—Ç —á–µ—Ä–µ–∑ `tun0`, –∫–∞–∫ –∏ Kilo CLI.

**–í—ã–≤–æ–¥ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

* –ü–æ—Å–∫–æ–ª—å–∫—É –≤ –≤–∞—à–µ–º —Å–ª—É—á–∞–µ Kilo CLI –≤–Ω—É—Ç—Ä–∏ vpn-ns –¥–µ–ª–∞–µ—Ç –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ `tun0` —É—Å–ø–µ—à–Ω–æ, –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã VS Code extension —Ç–æ–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª VPN ‚Äî **–æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–ª–æ LLM-–∑–∞–ø—Ä–æ—Å—ã –ª–æ–∫–∞–ª—å–Ω–æ–º—É Kilo backend/CLI**, –∏–ª–∏ —á—Ç–æ–±—ã VS Code Server/process **—Å–∞–º** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª HTTP proxy –≤–Ω—É—Ç—Ä–∏ vpn-namespace.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

* –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Kilo Code —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ –ª–æ–∫–∞–ª—å–Ω—ã–π Kilo CLI (–µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —ç—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç).
* –ï—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç –ø—Ä—è–º—ã–µ HTTP(S) –≤—ã–∑–æ–≤—ã, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `http.proxy` –≤ `settings.json` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ `http://127.0.0.1:1090` –∏–ª–∏ `http://vpn:1090`, –∏ —á—Ç–æ code-server –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω –≤–Ω—É—Ç—Ä–∏ dev (share netns), –ª–∏–±–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Å—Ç–∞–≤—å—Ç–µ env `HTTP_PROXY`/`HTTPS_PROXY` –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ code-server.
* –ï—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ proxy, –∑–∞–ø—É—Å—Ç–∏—Ç–µ/—Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ extension backend –≤–Ω—É—Ç—Ä–∏ dev-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–ª–∏ –≤–Ω–µ—Å–∏—Ç–µ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–ø—Ü–∏—é —É–∫–∞–∑–∞–Ω–∏—è proxy / –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ backend.

---

### 3) App –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

**–†–æ–ª—å:** –±–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –æ–±—ã—á–Ω–æ–π docker-—Å–µ—Ç–∏, –Ω–æ *—Ç–æ–ª—å–∫–æ LLM-–≤—ã–∑–æ–≤—ã* –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç —á–µ—Ä–µ–∑ VPN-proxy.

**–ö–∞–∫:** –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ user-defined bridge `vpn-net` –∏ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ proxy –ø–æ –∏–º–µ–Ω–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `vpn`:

* `socks5h://vpn:1080` –¥–ª—è Python LLM-–∫–ª–∏–µ–Ω—Ç–æ–≤ (requests/httpx —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π socks);
* `http://vpn:1090` –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç HTTP-–ø—Ä–æ–∫—Å–∏ (–µ—Å–ª–∏ extension/agent –∏—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç).

---

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ proxy vs direct calls: –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

* **socks5h** –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç, —á—Ç–æ–±—ã DNS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤–Ω—É—Ç—Ä–∏ VPN (–Ω–µ —É—Ç–µ–∫–∞–ª–æ –Ω–∞ —Ö–æ—Å—Ç).
* **HTTP proxy (Tinyproxy)**: VS Code Server –∏ –º–Ω–æ–≥–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —É–≤–∞–∂–∞—é—Ç `http.proxy` + `HTTP_PROXY`/`HTTPS_PROXY`. –ù–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –¥–µ–ª–∞—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã. –í —ç—Ç–∏—Ö —Å–ª—É—á–∞—è—Ö –Ω—É–∂–Ω–æ –ª–∏–±–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –ª–∏–±–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π backend (kilo CLI) –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π sidecar proxy.
* **Kilo extension**: –µ—Å–ª–∏ extension –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ backend (kilo CLI) ‚Äî —Ç–æ –ø—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—Å–µ –≤—ã–∑–æ–≤—ã –ø–æ–π–¥—É—Ç —á–µ—Ä–µ–∑ VPN. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–ø—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç `useLocalCli`, `backendEndpoint` –∏–ª–∏ –ø–æ—Ö–æ–∂–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.

---

## –°–µ—Ç–µ–≤—ã–µ –¥–µ—Ç–∞–ª–∏ –∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏

* `dev` –¥–µ–ª–∏—Ç DNS –∏ routing —Å `vpn` ‚Äî –∑–Ω–∞—á–∏—Ç, –ª—é–±—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤–Ω—É—Ç—Ä–∏ dev, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π resolver –∏ —Å–µ—Ç–µ–≤—ã–µ —Å—Ç–µ–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –±—É–¥—É—Ç —Ä–µ–∑–æ–ª–≤–∏—Ç—å –∏ –¥–µ–ª–∞—Ç—å egress —á–µ—Ä–µ–∑ VPN.
* –ï—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ) –¥–µ–ª–∞–µ—Ç –ø—Ä—è–º—ã–µ HTTP(S)-–≤—ã–∑–æ–≤—ã –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ code-server –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç proxy env/settings ‚Äî –æ–Ω –º–æ–∂–µ—Ç –≤—ã—Ö–æ–¥–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–Ω–æ –ª–∏–±–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å extension, –ª–∏–±–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å extension backend –ª–æ–∫–∞–ª—å–Ω–æ –≤–Ω—É—Ç—Ä–∏ dev –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ extension –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç backend.

---

## Docker network –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ compose

### –ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã

* –î–∞ ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **–º–æ–≥—É—Ç** –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∏–∑ —Å–≤–æ–µ–≥–æ `docker-compose`, –µ—Å–ª–∏ —Å–µ—Ç–µ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ (docker network) —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
* **–ï—Å–ª–∏ —Å–µ—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç** –∏ –≤ `docker-compose.yml` –æ–Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∞ –∫–∞–∫ `external: true`, —Ç–æ `docker compose up` —É–ø–∞–¥—ë—Ç —Å –æ—à–∏–±–∫–æ–π.
* **–ï—Å–ª–∏ —Å–µ—Ç—å –µ—Å—Ç—å**, –Ω–æ `vpn`-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω ‚Äî —Å–µ—Ç—å –ø—Ä–æ—Å—Ç–æ –±—É–¥–µ—Ç ¬´–ø—É—Å—Ç–æ–π¬ª (–æ–±—ã—á–Ω—ã–π bridge). App-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–º–æ–≥—É—Ç –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π, –Ω–æ –∏–º—è `vpn` –≤ Docker-DNS **–Ω–µ –±—É–¥–µ—Ç —Ä–µ–∑–æ–ª–≤–∏—Ç—å—Å—è** –≤ IP (—Ç.–µ. `socks5h://vpn:1080` ‚Äî –Ω–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç).
* –ù–∞–ª–∏—á–∏–µ —Å–µ—Ç–∏ **–Ω–µ —Å–æ–∑–¥–∞—ë—Ç VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å tun0** –∏ –Ω–µ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –≤ VPN –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî tun0 –∂–∏–≤—ë—Ç –≤–Ω—É—Ç—Ä–∏ vpn-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ü–æ–∫–∞ vpn –Ω–µ –∑–∞–ø—É—â–µ–Ω, ¬´vpn-—Å–µ—Ç—å¬ª ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–µ—Ç—å Docker –∏ —Ç—Ä–∞—Ñ–∏–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —É—Ö–æ–¥–∏—Ç –Ω–∞—Ä—É–∂—É –ø–æ –æ–±—ã—á–Ω–æ–º—É NAT —Ö–æ—Å—Ç–∞.

---

### –î–µ—Ç–∞–ª–∏: –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø–æ—á–µ–º—É

1. **Docker network vs VPN –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**

   * Docker network ‚Äî —ç—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–∏–π –º–æ—Å—Ç (bridge) —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π Docker daemon. –û–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –µ—Å—Ç—å –ª–∏ –≤–Ω—É—Ç—Ä–∏ –Ω–µ—ë –∫–∞–∫–∏–µ-—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
   * VPN (tun0) ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –ø–æ–¥–Ω—è—Ç—ã–π *–≤–Ω—É—Ç—Ä–∏* vpn-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –û–Ω –Ω–µ ¬´–≤–ø–∏–ª–∏–≤–∞–µ—Ç—Å—è¬ª –≤ Docker network. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø—Ä–æ–∫—Å–∏ –≤–Ω—É—Ç—Ä–∏ vpn-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (dante/tinyproxy) —Å–ª—É—à–∞–µ—Ç –Ω–∞ IP –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ Docker network –∏ –¥–µ–ª–∞–µ—Ç egress —á–µ—Ä–µ–∑ tun0.

2. **–ö–æ–≥–¥–∞ app –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Å–µ—Ç—å –µ—Å—Ç—å, –Ω–æ vpn –Ω–µ –∑–∞–ø—É—â–µ–Ω**

   * App –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ç–∏ `vpn-net` ‚Üí —ç—Ç–æ —É–¥–∞—á–Ω–æ.
   * `docker` DNS –≤—ã–¥–∞—ë—Ç –∏–º–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è **—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ —ç—Ç–æ–π —Å–µ—Ç–∏. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `vpn` –Ω–µ—Ç ‚Äî –∏–º—è `vpn` –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è.
   * –ï—Å–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∂—ë—Å—Ç–∫–æ —É–∫–∞–∑–∞–Ω `socks5h://vpn:1080`, –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å (Connection refused / name not found). –û–Ω–∏ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ ¬´–æ–±—ã—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç¬ª, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É–º–µ–µ—Ç fallback.
   * –ï—Å–ª–∏ –∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ **–Ω–µ —á–µ—Ä–µ–∑ proxy**, –∞ –Ω–∞–ø—Ä—è–º—É—é, –µ–≥–æ egress –ø–æ–π–¥—ë—Ç —á–µ—Ä–µ–∑ Docker NAT –Ω–∞ —Ö–æ—Å—Ç –∏ –¥–∞–ª–µ–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–æ–±—ã—á–Ω—ã–π —Ö–æ—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç).

3. **–ï—Å–ª–∏ vpn –∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

   * –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `vpn` ‚Äî –æ–Ω –±—É–¥–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—ë–Ω –∫ `vpn-net`, –ø–æ–ª—É—á–∏—Ç IP, Docker DNS –Ω–∞—á–Ω—ë—Ç —Ä–µ–∑–æ–ª–≤–∏—Ç—å `vpn` ‚Üí —Ç–æ–≥–¥–∞ `socks5h://vpn:1080` —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–º–æ–≥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –¥–µ–ª–∞—é—Ç –ø–æ–ø—ã—Ç–∫–∏). –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–µ–Ω restart –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –ª–æ–≥–∏–∫–∞ reconnection.

---

### –ú–æ–∂–µ—Ç –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–∑–¥–∞—Ç—å docker network?

**–ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç: ‚ùå –Ω–µ—Ç, –∏ —ç—Ç–æ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ**

**–ü–æ—á–µ–º—É?**

Docker network:

* —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **Docker daemon**
* **–ù–ï –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏**
* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä **–Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞** –∫ Docker API (–µ—Å–ª–∏ –≤—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –Ω–µ –ø—Ä–æ–±—Ä–æ—Å–∏–ª–∏ `/var/run/docker.sock`, —á—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ)

‚ùó –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –º–æ–∂–µ—Ç:

* —Å–æ–∑–¥–∞—Ç—å bridge-—Å–µ—Ç—å
* —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∞–≤–∞–º–∏ docker network
* –º–µ–Ω—è—Ç—å docker-level –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é

üìå **–î–∞–∂–µ `--cap-add NET_ADMIN` –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç** ‚Äî —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è *–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ* netns –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

---

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: `external: true` + bootstrap compose

#### –®–∞–≥ 0 ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ç—å **–æ–¥–∏–Ω —Ä–∞–∑**

```bash
docker network create vpn-net
```

(–¥–µ–ª–∞–µ—Ç—Å—è —Ä—É–∫–∞–º–∏ –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç–æ–º)

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
./vpn/
  Dockerfile
  entrypoint.sh
  danted.conf
  tinyproxy.conf
  dnsmasq.conf
  docker-compose.yml
./dev/
  Dockerfile
  docker-compose.yml
./apps/
  docker-compose.yml
./scripts/
  bootstrap.sh
```

---

### vpn/Dockerfile

```Dockerfile
FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update \
 && apt-get install -y --no-install-recommends \
    ca-certificates curl iproute2 iputils-ping procps \
    dnsmasq tinyproxy dante-server sudo \
 && rm -rf /var/lib/apt/lists/*

# –ö–æ–Ω—Ñ–∏–≥–∏ –∏ —Å–∫—Ä–∏–ø—Ç
COPY danted.conf /etc/danted.conf
COPY tinyproxy.conf /etc/tinyproxy/tinyproxy.conf
COPY dnsmasq.conf /etc/dnsmasq.conf
COPY entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh

EXPOSE 1080 1090

# –ù–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Ä—Ç—ã –Ω–∞—Ä—É–∂—É –Ω–∞ —Ö–æ—Å—Ç ‚Äî –æ–Ω–∏ –Ω—É–∂–Ω—ã –¥–ª—è —Å–≤—è–∑–∏ –≤–Ω—É—Ç—Ä–∏ docker-—Å–µ—Ç–∏
CMD ["/usr/local/bin/entrypoint.sh"]
```

---

### vpn/danted.conf (—à–∞–±–ª–æ–Ω)

```text
# Dante SOCKS server config (dante-server)
logoutput: /var/log/danted.log
internal: 0.0.0.0 port = 1080
external: tun0
method: none
user.privileged: root
user.notprivileged: nobody

client pass {
  from: 0.0.0.0/0 to: 0.0.0.0/0
}

socks pass {
  from: 0.0.0.0/0 to: 0.0.0.0/0
}
```

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: `external: tun0` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—ã—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ dante –±—É–¥–µ—Ç –∏–¥—Ç–∏ —á–µ—Ä–µ–∑ VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ï—Å–ª–∏ tun0 –µ—â—ë –Ω–µ –ø–æ–¥–Ω—è—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç —Å—Ç–∞—Ä—Ç–∞, entrypoint.sh –∂–¥—ë—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

---

### vpn/tinyproxy.conf (—à–∞–±–ª–æ–Ω)

```text
User nobody
Group nogroup
Port 1090
Timeout 600
DefaultErrorFile "/usr/share/tinyproxy/default.html"
StatFile "/usr/share/tinyproxy/stats.html"
Logfile "/var/log/tinyproxy/tinyproxy.log"
LogLevel Notice
PidFile "/var/run/tinyproxy.pid"
MaxClients 100
MinSpareServers 5
MaxSpareServers 20
StartServers 10

# allow local docker networks (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã)
Allow 127.0.0.1
Allow 0.0.0.0/0

# –ü—Ä–æ—Å–ª—É—à–∏–≤–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Äî dev (network_mode: container:vpn) –∏ –¥—Ä—É–≥–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫ vpn-net —Å–º–æ–≥—É—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –ø–æ –∏–º–µ–Ω–∏ 'vpn:1090'
Listen 0.0.0.0

# –†–∞–∑—Ä–µ—à–∞–µ–º CONNECT (HTTPS)
ConnectPort 443
ConnectPort 563
ConnectPort 80
```

---

### vpn/dnsmasq.conf (—à–∞–±–ª–æ–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–µ AdGuard DNS —Å–µ—Ä–≤–µ—Ä–∞)

```text
# dnsmasq –ø—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑–æ–ª–≤–µ—Ä–∞
no-resolv
server=94.140.14.14
server=94.140.15.15
listen-address=127.0.0.1
bind-interfaces
cache-size=1000
```

> –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å–≤–æ–π AdGuard DNS/AdGuard VPN –∫–ª–∏–µ–Ω—Ç ‚Äî –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å server= –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å.

---

### vpn/entrypoint.sh

```bash
#!/bin/bash
set -e

# –õ–æ–≥ –≤ stdout
mkdir -p /var/log

# 1) –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∑–∞–ø—É—Å—Ç–∏—Ç—å VPN-–∫–ª–∏–µ–Ω—Ç (adguardvpn-cli –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π)
# –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ adguardvpn-cli –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç–µ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ ADGUARDVPN_TOKEN, –ø–æ–ø—ã—Ç–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–∞.
# –ü—Ä–∏–º–µ—Ä: docker compose run -e ADGUARDVPN_TOKEN=... vpn

if [ -n "${ADGUARDVPN_TOKEN:-}" ]; then
  echo "[entrypoint] ADGUARDVPN_TOKEN –∑–∞–¥–∞–Ω ‚Äî –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å adguardvpn-cli"
  if command -v adguardvpn-cli >/dev/null 2>&1; then
    adguardvpn-cli login --token "$ADGUARDVPN_TOKEN" || true
    adguardvpn-cli connect --tcp || true
  else
    echo "[entrypoint] adguardvpn-cli –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—É—Å–∫ VPN-–∫–ª–∏–µ–Ω—Ç–∞."
  fi
fi

# 2) –ó–∞–ø—É—Å–∫–∞–µ–º dnsmasq (–ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∑–æ–ª–≤–µ—Ä) ‚Äî –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–µ–∑–æ–ª–≤ –≤–Ω—É—Ç—Ä–∏ vpn-namespace
if [ -f /etc/dnsmasq.conf ]; then
  echo "[entrypoint] —Å—Ç–∞—Ä—Ç dnsmasq"
  pkill dnsmasq || true
  dnsmasq --conf-file=/etc/dnsmasq.conf || true
fi

# 3) –ñ–¥—ë–º –ø–æ—è–≤–ª–µ–Ω–∏—è tun0 (–µ—Å–ª–∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
# –ñ–¥—ë–º –º–∞–∫—Å–∏–º—É–º 30s ‚Äî –µ—Å–ª–∏ –Ω–µ—Ç tun0, –ø—Ä–æ–¥–æ–ª–∂–∏–º, –Ω–æ danted external –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
for i in {1..30}; do
  if ip link show tun0 >/dev/null 2>&1; then
    echo "[entrypoint] –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å tun0 –Ω–∞–π–¥–µ–Ω"
    break
  fi
  echo "[entrypoint] –∂–¥—ë–º tun0... ($i/30)"
  sleep 1
done

# 4) –ó–∞–ø—É—Å–∫–∞–µ–º danted (socks5)
if [ -f /etc/danted.conf ]; then
  echo "[entrypoint] —Å—Ç–∞—Ä—Ç danted"
  pkill danted || true
  /usr/sbin/danted -f /etc/danted.conf &
fi

# 5) –ó–∞–ø—É—Å–∫–∞–µ–º tinyproxy (http)
if [ -f /etc/tinyproxy/tinyproxy.conf ]; then
  echo "[entrypoint] —Å—Ç–∞—Ä—Ç tinyproxy"
  pkill tinyproxy || true
  tinyproxy -c /etc/tinyproxy/tinyproxy.conf &
fi

# 6) –í—ã–≤–æ–¥ –ª–æ–≥–æ–≤ –≤ foreground (–ø—Ä–æ—Å—Ç–µ–π—à–∏–π —Å–ø–æ—Å–æ–± –¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∂–∏–≤—ã–º)
# –í—ã–≤–æ–¥–∏–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏ –≤ stdout –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
sleep 1

# tail –ª–æ–≥–æ–≤ –ø–æ –≤—Å–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–º —Ñ–∞–π–ª–∞–º
mkdir -p /var/log/tinyproxy /var/log
# –ù–µ –≤—Å–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º tail -F
tail -F /var/log/danted.log /var/log/tinyproxy/tinyproxy.log || true

# –ï—Å–ª–∏ tail –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–æ–∂–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è
```

---

### vpn/docker-compose.yml

```yaml
version: "3.8"

services:
  vpn:
    container_name: vpn
    build: .
    cap_add:
      - NET_ADMIN
    cap_drop:
      - ALL
    devices:
      - /dev/net/tun:/dev/net/tun
    restart: unless-stopped
    networks:
      - vpn-net
    volumes:
      - ./danted.conf:/etc/danted.conf:ro
      - ./tinyproxy.conf:/etc/tinyproxy/tinyproxy.conf:ro
      - ./dnsmasq.conf:/etc/dnsmasq.conf:ro

networks:
  vpn-net:
    external: true
```

üîë **–í–∞–∂–Ω–æ**

* compose **–ù–ï —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Ç—å**
* –æ–Ω –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ `vpn-net` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
* vpn –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

---

### dev/Dockerfile

```Dockerfile
FROM ubuntu:22.04
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update \
 && apt-get install -y --no-install-recommends \
    ca-certificates curl gnupg git build-essential sudo iproute2 procps \
 && rm -rf /var/lib/apt/lists/*

# –ü–∞–ø–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–ø—Ä–∏–º–µ—Ä—ã)
ARG USER=developer
ARG UID=1000
RUN useradd -m -u ${UID} -s /bin/bash ${USER} && echo "${USER} ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/${USER}
USER ${USER}
WORKDIR /home/${USER}/project

# --- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ code-server –∏ Kilo CLI ---
# –ú—ã –Ω–µ —Å—Ç–∞–≤–∏–º code-server –∏ kilo –≤ –æ–±—Ä–∞–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∏ token'–æ–≤.
# –ù–∏–∂–µ ‚Äî –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ Dockerfile –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏):
#
# 1) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å code-server (–ø—Ä–∏–º–µ—Ä):
#   curl -fsSL https://code-server.dev/install.sh | sh
#
# 2) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Kilo CLI (–ø—Ä–∏–º–µ—Ä):
#   curl -fsSL https://get.kilo.sh | sh
#
# 3) –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTP_PROXY/HTTPS_PROXY (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ), —Å–º. docker-compose ‚Äî dev –±—É–¥–µ—Ç share net namespace —Å vpn.

CMD ["/bin/bash"]
```

---

### dev/docker-compose.yml

```yaml
version: "3.8"

services:
  dev:
    container_name: dev
    build: .
    network_mode: "container:vpn"
    restart: unless-stopped
    volumes:
      - dev-data:/home/developer
      - ./project:/home/developer/project
    environment:
      - HTTP_PROXY=http://127.0.0.1:1090
      - HTTPS_PROXY=http://127.0.0.1:1090
      - NO_PROXY=localhost,127.0.0.1

volumes:
  dev-data:
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç**

* dev **–ù–ï –∑–∞–≤–∏—Å–∏—Ç –æ—Ç compose vpn**
* –Ω–æ **–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–∞–∫—Ç–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `vpn`**
* `docker compose up dev` —É–ø–∞–¥—ë—Ç, –µ—Å–ª–∏ `vpn` –Ω–µ –∑–∞–ø—É—â–µ–Ω ‚Äî –∏ —ç—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**

---

### apps/docker-compose.yml

```yaml
version: "3.8"

services:
  app1:
    image: ubuntu:22.04
    command: sleep infinity
    networks:
      - vpn-net
    environment:
      - ALL_PROXY=socks5h://vpn:1080

networks:
  vpn-net:
    external: true
```

---

### scripts/bootstrap.sh

```bash
#!/usr/bin/env bash
set -e

docker network inspect vpn-net >/dev/null 2>&1 || \
  docker network create vpn-net
```

‚úî –ø—Ä–æ—Å—Ç–æ
‚úî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ
‚úî –±–µ–∑–æ–ø–∞—Å–Ω–æ
‚úî production-friendly

---

## –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è, —á—Ç–æ–±—ã vpn compose ¬´—Å–æ–∑–¥–∞–≤–∞–ª —Å–µ—Ç—å —Å–∞–º¬ª?

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ docker-compose **–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ç—å**, –ù–û:

‚ùå —Ç–æ–≥–¥–∞:

* —Å–µ—Ç—å –±—É–¥–µ—Ç **–ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ lifecycle compose**
* `docker compose down` ‚Üí —Å–µ—Ç—å —É–¥–∞–ª–∏—Ç—Å—è
* –¥—Ä—É–≥–∏–µ compose —Å–ª–æ–º–∞—é—Ç—Å—è

üìå –≠—Ç–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é:

> vpn –∂–∏–≤—ë—Ç –æ—Ç–¥–µ–ª—å–Ω–æ, dev/app –ø—Ä–∏—Ö–æ–¥—è—Ç –∏ —É—Ö–æ–¥—è—Ç

---

## –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1) –°–æ–∑–¥–∞—ë–º —Å–µ—Ç—å –∑–∞—Ä–∞–Ω–µ–µ (bootstrap)

–°–æ–∑–¥–∞–π—Ç–µ `vpn-net` –æ–¥–∏–Ω —Ä–∞–∑ –≤—Ä—É—á–Ω—É—é (–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç–æ–º) ‚Äî —Ç–æ–≥–¥–∞ –ª—é–±–æ–π compose, –æ–±—ä—è–≤–∏–≤—à–∏–π `external: true`, –Ω–µ —É–ø–∞–¥—ë—Ç.

```bash
docker network inspect vpn-net >/dev/null 2>&1 || \
  docker network create vpn-net
```

–í `docker-compose.yml` –≤—Å–µ—Ö app/services –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```yaml
networks:
  vpn-net:
    external: true
```

–ü–ª—é—Å: –ø–æ–º–µ—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç `docker network create` –≤ `Makefile`/—Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è, —á—Ç–æ–±—ã –∫–æ–º–∞–Ω–¥–∞ –±—ã–ª–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π.

---

### 2) –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)

–õ—É—á—à–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ —Ç–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ:

1. `vpn` (–ø–æ–¥–Ω–∏–º–∞–µ—Ç proxy –∏ tun0)
2. `dev` / `apps`

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω–æ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –ø–æ—Ä—è–¥–æ–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ `vpn` —É–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω.

---

### 3) –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ proxy –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç proxy, –¥–∞–π—Ç–µ –µ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏–µ fallback:

* –≤–∞—Ä–∏–∞–Ω—Ç A: **–∂–¥–∞—Ç—å proxy** (healthcheck/loop) ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è `vpn:1080`;
* –≤–∞—Ä–∏–∞–Ω—Ç B: **fallback –Ω–∞ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø** (–µ—Å–ª–∏ –¥–æ–ø—É—Å—Ç–∏–º–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏);
* –≤–∞—Ä–∏–∞–Ω—Ç C: **–∑–∞–ø—É—Å–∫–∞—Ç—å —Å restart-policy –∏ healthcheck** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–∞–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, –µ—Å–ª–∏ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è.

---

### 4) –û–ø—Ü–∏—è ¬´stub proxy¬ª (–µ—Å–ª–∏ –Ω–∞–¥–æ, –Ω–æ —Å –æ–≥–æ–≤–æ—Ä–∫–∞–º–∏)

–ú–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –ª—ë–≥–∫–∏–π stub-proxy (small sidecar) –≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã–º, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç connections –Ω–∞ `vpn:1080` –∏:

* –ª–∏–±–æ –æ—Ç–≤–µ—Ç–∏—Ç –æ—à–∏–±–∫–æ–π / 502, –ø–æ–∫–∞ —Ä–µ–∞–ª—å–Ω—ã–π proxy –Ω–µ –ø–æ—è–≤–∏–ª—Å—è,
* –ª–∏–±–æ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞–ø—Ä—è–º—É—é –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ ¬´–º—è–≥–∫–∏–π¬ª fallback).

–ú–∏–Ω—É—Å—ã: —Ç–∞–∫–æ–π stub –º–æ–∂–µ—Ç –ø–æ –æ—à–∏–±–∫–µ –¥–∞—Ç—å egress –≤–Ω–µ VPN ‚Üí –Ω–∞–¥–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–¥—É–º–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

---

### 5) dev —Å `network_mode: "container:vpn"`

–î–ª—è dev: –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `network_mode: "container:vpn"`, —Ç–æ dev –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å **—Ç–æ–ª—å–∫–æ** –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ç–æ—á–Ω—ã–º –∏–º–µ–Ω–µ–º `vpn` –∑–∞–ø—É—â–µ–Ω. –≠—Ç–æ —Ö–æ—Ä–æ—à–∏–π —Å–ø–æ—Å–æ–± –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ dev –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç —Ç–µ –∂–µ –º–∞—Ä—à—Ä—É—Ç—ã/DNS, —á—Ç–æ vpn. –ù–æ –æ–±—Ä–∞—Ç–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –ø–æ–¥–Ω—è—Ç—å dev –µ—Å–ª–∏ vpn –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.

---

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å ‚Äî quickstart

1. Bootstrap (–æ–¥–∏–Ω —Ä–∞–∑):

```bash
chmod +x scripts/bootstrap.sh
./scripts/bootstrap.sh
```

2. –ü–æ–¥–Ω—è—Ç—å vpn:

```bash
cd vpn
docker compose up -d
```

3. –ü–æ–¥–Ω—è—Ç—å dev:

```bash
cd dev
docker compose up -d
```

4. –ü–æ–¥–Ω—è—Ç—å apps:

```bash
cd apps
docker compose up -d
```

5. –ü—Ä–æ–≤–µ—Ä–∫–∏ (–∏–∑ `dev` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —Ç.–∫. –æ–Ω —à–∞—Ä–∏—Ç netns —Å `vpn`):

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker exec -it dev bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π IP —á–µ—Ä–µ–∑ tinyproxy
curl --proxy http://127.0.0.1:1090 https://api.ipify.org
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ socks5 (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å curl + proxychains –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ–µ socks5h)
```

---

## –í–∞–∂–Ω–æ ‚Äî –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* **adguardvpn-cli:** –í Dockerfile —è –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π VPN-–∫–ª–∏–µ–Ω—Ç (adguardvpn-cli), —Ç.–∫. –æ–Ω –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤/–∫–ª—é—á–µ–π –∏ –ª–∏—Ü–µ–Ω–∑–∏–π. –í `entrypoint.sh` –µ—Å—Ç—å —Ç–æ—á–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ‚Äî –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `adguardvpn-cli`, –¥–æ–±–∞–≤—å—Ç–µ —à–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ Dockerfile –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `ADGUARDVPN_TOKEN`.
* **DNS:** –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ–¥–Ω—è—Ç `dnsmasq`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ AdGuard DNS (94.140.14.14/15). –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç, —á—Ç–æ —Ä–µ–∑–æ–ª–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ vpn-namespace.
* **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–π—Ç–µ –ø—Ä–æ–∫—Å–∏-–ø–æ—Ä—Ç—ã –Ω–∞ —Ö–æ—Å—Ç. –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –ø—Ä–æ–∫—Å–∏ –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ tinyproxy/danted.
* **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:** –º—ã **–Ω–µ** —Ç—Ä–æ–≥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Ö–æ—Å—Ç–∞ ‚Äî –≤—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ vpn –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (tun0).
* **Dev credentials:** developer credentials —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `dev-data` volume; –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ anonymous volume –∏–ª–∏ tmpfs –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –ø—Ä–∏ rm.
* **Apps:** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ `vpn-net` –∏ –¥–æ–ª–∂–Ω—ã –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å LLM-–≤—ã–∑–æ–≤—ã –Ω–∞ `socks5h://vpn:1080` –∏–ª–∏ `http://vpn:1090`. –î–ª—è Python: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `socks5h` —á—Ç–æ–±—ã DNS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤–Ω—É—Ç—Ä–∏ VPN.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ troubleshooting

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP Kilo CLI (–∏–∑ dev):

```bash
docker exec -it dev curl --silent https://api.ipify.org
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: IP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ VPN.

---

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP –≤—ã–∑–æ–≤–∞, –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ extension (–µ—Å–ª–∏ –µ—Å—Ç—å –æ–ø—Ü–∏—è —Ç–µ—Å—Ç–∞ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏)

* –ï—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–º–µ–µ—Ç diagnostic/log –∏–ª–∏ –∫–Ω–æ–ø–∫—É ¬´test connection¬ª, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ—ë –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å—Ö–æ–¥—è—â–∏–π IP –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ LLM-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, –ª–∏–±–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏/headers.

---

### 3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∏–∑ VS Code Server –ø—Ä–æ—Ü–µ—Å—Å–∞

* –í–Ω—É—Ç—Ä–∏ dev –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: `curl --proxy http://127.0.0.1:1090 https://api.ipify.org` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ http-proxy –¥–∞–µ—Ç egress —á–µ—Ä–µ–∑ VPN.

---

### 4. –ï—Å–ª–∏ extension –≤—Å—ë –µ—â—ë –¥–µ–ª–∞–µ—Ç –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã

* –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–µ—Å—Ç—å –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä backend/local cli);
* –≤–∫–ª—é—á–∏—Ç–µ env `HTTP_PROXY`/`HTTPS_PROXY` –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ code-server (–≤ dev-compose) –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ code-server;
* –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π sidecar (–Ω–∞–ø—Ä–∏–º–µ—Ä `socat`) –≤–Ω—É—Ç—Ä–∏ dev, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–≤–∞—Ä–¥–∏—Ç –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã –≤ proxy –≤–Ω—É—Ç—Ä–∏ vpn.

---

## –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π checklist –ø–µ—Ä–µ–¥ production

* [ ] –°–æ–∑–¥–∞—Ç—å —Å–µ—Ç—å `vpn-net` –∑–∞—Ä–∞–Ω–µ–µ (—Å–∫—Ä–∏–ø—Ç/Makefile).
* [ ] –í `compose` –≤—Å–µ—Ö apps —É–∫–∞–∑–∞—Ç—å `external: true` –¥–ª—è `vpn-net`.
* [ ] –†–µ—à–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ proxy (–∂–¥–∞—Ç—å/—Ñ–µ–π–ª–∏—Ç—å/—Ñ–æ–ª–±—ç–∫).
* [ ] –†–µ—à–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞: –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∞—á–∞–ª–∞ `vpn`, –ø–æ—Ç–æ–º `dev/apps`.
* [ ] –ù–µ –∑–∞–±—ã—Ç—å –ø—Ä–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø ‚Äî –ø–æ–Ω–∏–º–∞—Ç—å —Ä–∏—Å–∫–∏ —É—Ç–µ—á–∫–∏ credentials/LLM-–∑–∞–ø—Ä–æ—Å–æ–≤.
* [ ] Kilo CLI –≤–Ω—É—Ç—Ä–∏ dev –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ tun0 (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ);
* [ ] VS Code extension Kilo Code –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π Kilo backend / CLI –∏–ª–∏ —É–≤–∞–∂–∞–µ—Ç `http.proxy` (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ);
* [ ] –ï—Å–ª–∏ extension –¥–µ–ª–∞–µ—Ç –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã ‚Äî –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å extension –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ backend –≤–Ω—É—Ç—Ä–∏ dev;
* [ ] –ù–∏–∫–∞–∫–∏—Ö proxy-–ø–æ—Ä—Ç–æ–≤ –Ω–µ –ø—Ä–æ–±—Ä–æ—à–µ–Ω–æ –Ω–∞ —Ö–æ—Å—Ç;
* [ ] –õ–æ–≥–∏ proxy –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç Authorization header;
* [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ alerting –¥–ª—è VPN/proxy.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ ‚Äî —á—Ç–æ Kilo CLI –≤–Ω—É—Ç—Ä–∏ vpn-ns —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `tun0` ‚Äî –¥–∞—ë—Ç –Ω–∞–º —É—Å—Ç–æ–π—á–∏–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é: **—Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã VS Code extension –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–ª LLM-–∑–∞–ø—Ä–æ—Å—ã –ª–æ–∫–∞–ª—å–Ω–æ–º—É backend/CLI, –∏–ª–∏ —á—Ç–æ–±—ã code-server –ø—Ä–æ—Ü–µ—Å—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª http-proxy –≤–Ω—É—Ç—Ä–∏ vpn**, —Ç–æ–≥–¥–∞ –≤—Å–µ LLM-–≤—ã–∑–æ–≤—ã –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ç–∞–∫–∂–µ –ø–æ–π–¥—É—Ç —á–µ—Ä–µ–∑ VPN.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

* ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ docker-compose —Ñ–∞–π–ª—ã
* ‚úÖ –ì–∏–±–∫—É—é —Å–µ—Ç—å —Å external: true –∏ bootstrap
* ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (vpn) –∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (dev/apps)
* ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö ‚Äî —Ç–æ–ª—å–∫–æ LLM-–≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ proxy
* ‚úÖ –ò–∑–æ–ª—è—Ü–∏—é developer credentials –≤–Ω—É—Ç—Ä–∏ dev-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
* ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Ö–æ—Å—Ç–∞
